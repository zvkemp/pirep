import e from"../../lib/codemirror.js";var t="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;(function(t){t(e)})((function(e){var n=e.Pos;function regexpFlags(e){var t=e.flags;return null!=t?t:(e.ignoreCase?"i":"")+(e.global?"g":"")+(e.multiline?"m":"")}function ensureFlags(e,t){var n=regexpFlags(e),r=n;for(var i=0;i<t.length;i++)-1==r.indexOf(t.charAt(i))&&(r+=t.charAt(i));return n==r?e:new RegExp(e.source,r)}function maybeMultiline(e){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(e.source)}function searchRegexpForward(e,t,r){t=ensureFlags(t,"g");for(var i=r.line,s=r.ch,a=e.lastLine();i<=a;i++,s=0){t.lastIndex=s;var l=e.getLine(i),o=t.exec(l);if(o)return{from:n(i,o.index),to:n(i,o.index+o[0].length),match:o}}}function searchRegexpForwardMultiline(e,t,r){if(!maybeMultiline(t))return searchRegexpForward(e,t,r);t=ensureFlags(t,"gm");var i,s=1;for(var a=r.line,l=e.lastLine();a<=l;){for(var o=0;o<s;o++){if(a>l)break;var h=e.getLine(a++);i=null==i?h:i+"\n"+h}s*=2;t.lastIndex=r.ch;var c=t.exec(i);if(c){var f=i.slice(0,c.index).split("\n"),u=c[0].split("\n");var g=r.line+f.length-1,d=f[f.length-1].length;return{from:n(g,d),to:n(g+u.length-1,1==u.length?d+u[0].length:u[u.length-1].length),match:c}}}}function lastMatchIn(e,t,n){var r,i=0;while(i<=e.length){t.lastIndex=i;var s=t.exec(e);if(!s)break;var a=s.index+s[0].length;if(a>e.length-n)break;(!r||a>r.index+r[0].length)&&(r=s);i=s.index+1}return r}function searchRegexpBackward(e,t,r){t=ensureFlags(t,"g");for(var i=r.line,s=r.ch,a=e.firstLine();i>=a;i--,s=-1){var l=e.getLine(i);var o=lastMatchIn(l,t,s<0?0:l.length-s);if(o)return{from:n(i,o.index),to:n(i,o.index+o[0].length),match:o}}}function searchRegexpBackwardMultiline(e,t,r){if(!maybeMultiline(t))return searchRegexpBackward(e,t,r);t=ensureFlags(t,"gm");var i,s=1,a=e.getLine(r.line).length-r.ch;for(var l=r.line,o=e.firstLine();l>=o;){for(var h=0;h<s&&l>=o;h++){var c=e.getLine(l--);i=null==i?c:c+"\n"+i}s*=2;var f=lastMatchIn(i,t,a);if(f){var u=i.slice(0,f.index).split("\n"),g=f[0].split("\n");var d=l+u.length,v=u[u.length-1].length;return{from:n(d,v),to:n(d+g.length-1,1==g.length?v+g[0].length:g[g.length-1].length),match:f}}}}var r,i;if(String.prototype.normalize){r=function(e){return e.normalize("NFD").toLowerCase()};i=function(e){return e.normalize("NFD")}}else{r=function(e){return e.toLowerCase()};i=function(e){return e}}function adjustPos(e,t,n,r){if(e.length==t.length)return n;for(var i=0,s=n+Math.max(0,e.length-t.length);;){if(i==s)return i;var a=i+s>>1;var l=r(e.slice(0,a)).length;if(l==n)return a;l>n?s=a:i=a+1}}function searchStringForward(e,t,s,a){if(!t.length)return null;var l=a?r:i;var o=l(t).split(/\r|\n\r?/);e:for(var h=s.line,c=s.ch,f=e.lastLine()+1-o.length;h<=f;h++,c=0){var u=e.getLine(h).slice(c),g=l(u);if(1==o.length){var d=g.indexOf(o[0]);if(-1==d)continue e;s=adjustPos(u,g,d,l)+c;return{from:n(h,adjustPos(u,g,d,l)+c),to:n(h,adjustPos(u,g,d+o[0].length,l)+c)}}var v=g.length-o[0].length;if(g.slice(v)==o[0]){for(var p=1;p<o.length-1;p++)if(l(e.getLine(h+p))!=o[p])continue e;var m=e.getLine(h+o.length-1),x=l(m),L=o[o.length-1];if(x.slice(0,L.length)==L)return{from:n(h,adjustPos(u,g,v,l)+c),to:n(h+o.length-1,adjustPos(m,x,L.length,l))}}}}function searchStringBackward(e,t,s,a){if(!t.length)return null;var l=a?r:i;var o=l(t).split(/\r|\n\r?/);e:for(var h=s.line,c=s.ch,f=e.firstLine()-1+o.length;h>=f;h--,c=-1){var u=e.getLine(h);c>-1&&(u=u.slice(0,c));var g=l(u);if(1==o.length){var d=g.lastIndexOf(o[0]);if(-1==d)continue e;return{from:n(h,adjustPos(u,g,d,l)),to:n(h,adjustPos(u,g,d+o[0].length,l))}}var v=o[o.length-1];if(g.slice(0,v.length)==v){var p=1;for(s=h-o.length+1;p<o.length-1;p++)if(l(e.getLine(s+p))!=o[p])continue e;var m=e.getLine(h+1-o.length),x=l(m);if(x.slice(x.length-o[0].length)==o[0])return{from:n(h+1-o.length,adjustPos(m,x,m.length-o[0].length,l)),to:n(h,adjustPos(u,g,v.length,l))}}}}function SearchCursor(e,r,i,s){(this||t).atOccurrence=false;(this||t).afterEmptyMatch=false;(this||t).doc=e;i=i?e.clipPos(i):n(0,0);(this||t).pos={from:i,to:i};var a;if("object"==typeof s)a=s.caseFold;else{a=s;s=null}if("string"==typeof r){null==a&&(a=false);(this||t).matches=function(t,n){return(t?searchStringBackward:searchStringForward)(e,r,n,a)}}else{r=ensureFlags(r,"gm");s&&false===s.multiline?(this||t).matches=function(t,n){return(t?searchRegexpBackward:searchRegexpForward)(e,r,n)}:(this||t).matches=function(t,n){return(t?searchRegexpBackwardMultiline:searchRegexpForwardMultiline)(e,r,n)}}}SearchCursor.prototype={findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(r){var i=(this||t).doc.clipPos(r?(this||t).pos.from:(this||t).pos.to);if((this||t).afterEmptyMatch&&(this||t).atOccurrence){i=n(i.line,i.ch);if(r){i.ch--;if(i.ch<0){i.line--;i.ch=((this||t).doc.getLine(i.line)||"").length}}else{i.ch++;if(i.ch>((this||t).doc.getLine(i.line)||"").length){i.ch=0;i.line++}}if(0!=e.cmpPos(i,(this||t).doc.clipPos(i)))return(this||t).atOccurrence=false}var s=this.matches(r,i);(this||t).afterEmptyMatch=s&&0==e.cmpPos(s.from,s.to);if(s){(this||t).pos=s;(this||t).atOccurrence=true;return(this||t).pos.match||true}var a=n(r?(this||t).doc.firstLine():(this||t).doc.lastLine()+1,0);(this||t).pos={from:a,to:a};return(this||t).atOccurrence=false},from:function(){if((this||t).atOccurrence)return(this||t).pos.from},to:function(){if((this||t).atOccurrence)return(this||t).pos.to},replace:function(r,i){if((this||t).atOccurrence){var s=e.splitLines(r);(this||t).doc.replaceRange(s,(this||t).pos.from,(this||t).pos.to,i);(this||t).pos.to=n((this||t).pos.from.line+s.length-1,s[s.length-1].length+(1==s.length?(this||t).pos.from.ch:0))}}};e.defineExtension("getSearchCursor",(function(e,n,r){return new SearchCursor((this||t).doc,e,n,r)}));e.defineDocExtension("getSearchCursor",(function(e,n,r){return new SearchCursor(this||t,e,n,r)}));e.defineExtension("selectMatches",(function(t,n){var r=[];var i=this.getSearchCursor(t,this.getCursor("from"),n);while(i.findNext()){if(e.cmpPos(i.to(),this.getCursor("to"))>0)break;r.push({anchor:i.from(),head:i.to()})}r.length&&this.setSelections(r,0)}))}));var n={};export{n as default};

